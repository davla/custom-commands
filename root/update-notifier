#!/usr/bin/env bash

# This scripts is meant to be run in the background to
# checks for system updates. If any are found it reopens
# itself in a terminal window with the upgrades ready
# to be installed.

#####################################################
#
#                   Aliases
#
#####################################################

shopt -s expand_aliases

# Echoes normally if from terminal emulator, otherwise uses syslog
tty -s && alias print='echo' || alias print='logger -p local0.info -t UPDATES'

#####################################################
#
#           Terminal: ready to upgrade
#
#####################################################

if tty -s; then
	apt-get upgrade
	exit 0
fi

#####################################################
#
#       Background: checking for updates
#
#####################################################

apt-get update
apt-get upgrade --assume-no

if [[ $? -eq 0 ]]; then
    print 'updates not found'
else
    print 'updates found'

    # Updates found, opening terminal window
    run-in-terminal "bash $0"
fi
